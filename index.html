<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>æç«œè²©å£²ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</title>
<style>
  :root{
    --bg:#0b0f14; --txt:rgba(255,255,255,.92); --mut:rgba(255,255,255,.60);
    --stroke:rgba(255,255,255,.10); --shadow:0 14px 40px rgba(0,0,0,.30);
    --r:18px; --good:#78ffb3;

    --male:#74d7ff; --maleBg:rgba(116,215,255,.18); --maleStroke:rgba(116,215,255,.40);
    --female:#ff86c8; --femaleBg:rgba(255,134,200,.18); --femaleStroke:rgba(255,134,200,.40);
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--txt);
    font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
    background:
      radial-gradient(900px 700px at 20% -10%, rgba(116,215,255,.18), transparent 55%),
      radial-gradient(800px 700px at 120% 20%, rgba(255,134,200,.12), transparent 55%),
      var(--bg);
    padding-top:calc(10px + env(safe-area-inset-top));
    padding-bottom:calc(92px + env(safe-area-inset-bottom));
  }

  /* âœ… ä¸Šå›ºå®šï¼šå‡ºåŠ› + åˆè¨ˆ + ã‚³ãƒ”ãƒ¼ */
  .topBar{
    position:sticky; top:0; z-index:20;
    padding:10px 12px;
    padding-top:calc(10px + env(safe-area-inset-top));
    backdrop-filter:blur(18px);
    background:linear-gradient(to bottom, rgba(11,15,20,.92), rgba(11,15,20,.40));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .topRow{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    margin-bottom:8px;
  }
  .brand{font-weight:900; font-size:14px; letter-spacing:.2px; opacity:.92}
  .total{font-size:12px; color:var(--mut)}
  .total b{color:var(--good); font-size:14px}
  .copyBtn{
    height:36px; padding:0 14px; border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.08);
    color:var(--txt); font-weight:900; font-size:14px;
    touch-action:manipulation;
    white-space:nowrap;
  }
  .copyBtn:active{transform:scale(.99);}
  textarea{
    width:100%;
    height:108px; /* âœ… å°ã•ã‚ã§ä¸Šå›ºå®š */
    resize:none;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:var(--txt);
    padding:10px 12px;
    font-size:12px;
    line-height:1.45;
    outline:none;
  }

  .wrap{padding:12px 14px;}

  /* list cards */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    border:1px solid var(--stroke);
    border-radius:var(--r);
    padding:12px;
    box-shadow:var(--shadow);
    margin-bottom:10px;
  }
  .toprow{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
  .name{font-weight:900; font-size:15px}
  .rightInfo{display:flex; flex-direction:column; align-items:flex-end; gap:4px}
  .badge{
    font-size:12px; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    white-space:nowrap;
  }
  .unitPrice{font-size:12px; color:var(--mut)}
  .controls{margin-top:10px; display:flex; flex-direction:column; gap:10px}
  select{
    width:100%;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:var(--txt);
    border-radius:14px;
    padding:10px 12px;
    font-size:15px;
    outline:none;
  }
  .sexrow{display:flex; gap:10px}
  .sexbox{
    flex:1;
    border-radius:16px;
    padding:10px;
    border:2px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06);
  }
  .sexbox.male{ background:var(--maleBg); border-color:var(--maleStroke); }
  .sexbox.female{ background:var(--femaleBg); border-color:var(--femaleStroke); }
  .sexhead{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
  .label{font-weight:900; font-size:13px}
  .label.m{color:var(--male)}
  .label.f{color:var(--female)}
  .count{font-variant-numeric:tabular-nums; font-size:20px; font-weight:900}
  .btnrow{display:flex; gap:10px}
  .btn{
    flex:1; height:42px; border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.08);
    color:var(--txt); font-size:22px; font-weight:900;
    touch-action:manipulation;
  }
  .btn.plus.m{ color:var(--male); border-color:rgba(116,215,255,.45); }
  .btn.plus.f{ color:var(--female); border-color:rgba(255,134,200,.45); }
  .disabled{opacity:.35; pointer-events:none}

  /* ä¸‹ã®ä½™ç™½ï¼ˆiPhoneã§ã‚«ãƒ¼ãƒ‰ãŒãƒœã‚¿ãƒ³ã«éš ã‚Œãªã„ï¼‰ */
  .spacer{height:14px;}
</style>
</head>
<body>

<div class="topBar">
  <div class="topRow">
    <div class="brand">ğŸ¦– æç«œã‚³ãƒ”ãƒ¼</div>
    <div class="total">åˆè¨ˆ <b id="totalView">0å††</b></div>
    <button class="copyBtn" onclick="copyText()">ã‚³ãƒ”ãƒ¼</button>
  </div>
  <textarea id="result" readonly placeholder="å…¥åŠ›ã™ã‚‹ã¨ã“ã“ã«è‡ªå‹•ã§å‡ºã¾ã™"></textarea>
</div>

<div class="wrap" id="list"></div>
<div class="spacer"></div>

<script>
  const prices = {"å—ç²¾åµ":30,"å—ç²¾åµ(æŒ‡å®š)":50,"å¹¼ä½“":100,"èƒš":50,"èƒš(æŒ‡å®š)":100,"æˆä½“":500};

  // âœ… â™‚â™€å…¥åŠ›å¯¾è±¡ï¼ˆãƒšã‚¢åˆ¤å®šã‚ã‚Šï¼‰
  const sexTypes  = new Set(["å—ç²¾åµ(æŒ‡å®š)","èƒš(æŒ‡å®š)","å¹¼ä½“","æˆä½“"]);
  const pairTypes = new Set(["å—ç²¾åµ(æŒ‡å®š)","èƒš(æŒ‡å®š)","å¹¼ä½“","æˆä½“"]);

  let dinos = [];
  const state = new Map();

  const list = document.getElementById("list");
  const totalView = document.getElementById("totalView");
  const resultTa = document.getElementById("result");

  function yen(n){ return `${Number(n).toLocaleString("ja-JP")}å††`; }

  async function loadDinos(){
    const res = await fetch(`dinos.txt?ts=${Date.now()}`);
    const text = await res.text();
    dinos = text.split(/\r?\n/).map(s => s.trim().replace(/^ãƒ»\s*/,"")).filter(Boolean);
    dinos.forEach(d => state.set(d, { type:"å—ç²¾åµ", m:0, f:0 }));
    render();
    refreshOutput();
  }

  function baseName(type){
    return type.replace("(æŒ‡å®š)", "");
  }

  function formatLine(type, m, f){
    const qty = m + f;
    if (qty <= 0) return "";

    // âœ… ãƒšã‚¢åˆ¤å®šï¼ˆæŒ‡å®š/å¹¼ä½“/æˆä½“ï¼‰
    if (pairTypes.has(type)){
      const base = baseName(type);
      if (m === f && m > 0){
        return `${base}ãƒšã‚¢${m > 1 ? "Ã—" + m : ""}`;
      }
      const parts = [];
      if (m > 0) parts.push(`â™‚Ã—${m}`);
      if (f > 0) parts.push(`â™€Ã—${f}`);
      return `${base} ${parts.join(" ")}`.trim();
    }

    // âœ… ãã‚Œä»¥å¤–ï¼šæ€§åˆ¥ãªã—åˆç®—
    return `${type}Ã—${qty}`;
  }

  function refreshOutput(){
    let lines = [];
    let total = 0;
    let idx = 1;

    for (const name of dinos){
      const s = state.get(name);
      if (!s) continue;

      const type = s.type;
      const m = s.m;
      const f = s.f;
      const qty = m + f;
      if (qty === 0) continue;

      const price = (prices[type] || 0) * qty;
      total += price;

      lines.push(`${idx}. ${name} ${formatLine(type, m, f)} = ${price}å††`);
      idx++;
    }

    totalView.textContent = yen(total);

    resultTa.value =
`ã“ã®åº¦ã¯ã”æ¤œè¨ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
ã”å¸Œæœ›å†…å®¹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ğŸ‘‡ğŸ»

${lines.join("\n")}
ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
è¨ˆï¼š${total}å††
æœ€çŸ­ç´å“ç›®å®‰ : å³ç´å“å¯èƒ½

ã”å¸Œæœ›å†…å®¹ã€é‡‘é¡ã‚’ã”ç¢ºèªã®ä¸Šè³¼å…¥ã®æ–¹ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ğŸ™ğŸ»

ã¾ãŸã€è¿½åŠ ã‚„å¤‰æ›´ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ğŸ‘ğŸ»`;
  }

  function render(){
    list.innerHTML = "";

    for (const name of dinos){
      const s = state.get(name);
      const card = document.createElement("div");
      card.className = "card";
      card.dataset.name = name;

      card.innerHTML = `
        <div class="toprow">
          <div class="name">${name}</div>
          <div class="rightInfo">
            <div class="badge">${s.type}</div>
            <div class="unitPrice">å˜ä¾¡ ${yen(prices[s.type] || 0)}</div>
          </div>
        </div>

        <div class="controls">
          <select class="type">
            <option ${s.type==="å—ç²¾åµ"?"selected":""}>å—ç²¾åµ</option>
            <option ${s.type==="å—ç²¾åµ(æŒ‡å®š)"?"selected":""}>å—ç²¾åµ(æŒ‡å®š)</option>
            <option ${s.type==="å¹¼ä½“"?"selected":""}>å¹¼ä½“</option>
            <option ${s.type==="èƒš"?"selected":""}>èƒš</option>
            <option ${s.type==="èƒš(æŒ‡å®š)"?"selected":""}>èƒš(æŒ‡å®š)</option>
            <option ${s.type==="æˆä½“"?"selected":""}>æˆä½“</option>
          </select>

          <div class="sexrow">
            <div class="sexbox male">
              <div class="sexhead">
                <div class="label m">â™‚ ã‚ªã‚¹</div>
                <div class="count mcnt">${s.m}</div>
              </div>
              <div class="btnrow">
                <button class="btn" type="button" data-sex="m" data-d="-1">âˆ’</button>
                <button class="btn plus m" type="button" data-sex="m" data-d="1">ï¼‹</button>
              </div>
            </div>

            <div class="sexbox female">
              <div class="sexhead">
                <div class="label f">â™€ ãƒ¡ã‚¹</div>
                <div class="count fcnt">${s.f}</div>
              </div>
              <div class="btnrow">
                <button class="btn" type="button" data-sex="f" data-d="-1">âˆ’</button>
                <button class="btn plus f" type="button" data-sex="f" data-d="1">ï¼‹</button>
              </div>
            </div>
          </div>
        </div>
      `;
      list.appendChild(card);

      const sel = card.querySelector(".type");
      const badge = card.querySelector(".badge");
      const unitPriceEl = card.querySelector(".unitPrice");
      const femaleBox = card.querySelector(".female");

      function applyMode(){
        const st = state.get(name);
        badge.textContent = st.type;
        unitPriceEl.textContent = `å˜ä¾¡ ${yen(prices[st.type] || 0)}`;

        // âœ… â™‚â™€ãŒä¸è¦ãªã‚¿ã‚¤ãƒ—ã¯â™€ã‚’ç„¡åŠ¹åŒ–ã—ã¦0ã«å¯„ã›ã‚‹ï¼ˆå‡ºåŠ›ã¯åˆç®—ï¼‰
        if (!sexTypes.has(st.type)){
          st.f = 0;
          card.querySelector(".fcnt").textContent = "0";
          femaleBox.classList.add("disabled");
        } else {
          femaleBox.classList.remove("disabled");
        }

        refreshOutput(); // âœ… å¸¸ã«æ›´æ–°
      }

      sel.addEventListener("change", () => {
        const st = state.get(name);
        st.type = sel.value;
        applyMode();
      });

      card.querySelectorAll("button[data-sex]").forEach(b => {
        b.addEventListener("click", () => {
          const st = state.get(name);
          const sex = b.dataset.sex;
          const d = Number(b.dataset.d);

          if (!sexTypes.has(st.type) && sex === "f") return;

          st[sex] = Math.max(0, st[sex] + d);
          card.querySelector(sex==="m" ? ".mcnt" : ".fcnt").textContent = st[sex];

          refreshOutput(); // âœ… å¢—æ¸›ã—ãŸã‚‰å³æ›´æ–°
        });
      });

      applyMode(); // åˆæœŸé©ç”¨
    }
  }

  async function copyText(){
    if (!resultTa.value.trim()){
      alert("ã¾ã å‡ºåŠ›ãŒã‚ã‚Šã¾ã›ã‚“");
      return;
    }
    try{
      await navigator.clipboard.writeText(resultTa.value);
      // ã†ã‚‹ã•ãã—ãªã„ï¼šæˆåŠŸã‚¢ãƒ©ãƒ¼ãƒˆã¯ç„¡ã—
    }catch(e){
      resultTa.focus(); resultTa.select();
      document.execCommand("copy");
    }
  }

  loadDinos();
</script>

</body>
</html>
