<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>æç«œè²©å£²ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</title>
<style>
  :root{
    --bg:#0b0c10; --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.60);
    --accent:#7cf2ff; --good:#78ffb3; --shadow:0 14px 40px rgba(0,0,0,.35); --r:18px;
  }
  *{box-sizing:border-box;}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;color:var(--text);
    background:
      radial-gradient(1200px 900px at 10% -10%, rgba(124,242,255,.22), transparent 55%),
      radial-gradient(900px 900px at 110% 10%, rgba(120,255,179,.14), transparent 55%),
      var(--bg);
    padding-bottom:120px;
  }
  .top{position:sticky;top:0;z-index:50;padding:14px 14px 10px;padding-top:calc(14px + env(safe-area-inset-top));
    backdrop-filter:blur(18px);background:linear-gradient(to bottom, rgba(11,12,16,.78), rgba(11,12,16,.25));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .title{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;}
  .title h1{margin:0;font-size:18px;}
  .pill{padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);color:var(--muted);font-size:12px;white-space:nowrap;}
  .searchRow{margin-top:10px;display:flex;gap:10px;align-items:center;}
  .search{flex:1;display:flex;align-items:center;gap:10px;padding:12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);}
  .search input{width:100%;border:0;outline:none;background:transparent;color:var(--text);font-size:15px;}
  .toggle{display:flex;align-items:center;gap:8px;padding:12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);font-size:13px;color:var(--muted);user-select:none;}
  .toggle input{width:18px;height:18px;}
  .wrap{padding:12px 14px;}
  .card{border-radius:var(--r);background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    border:1px solid rgba(255,255,255,.10);box-shadow:var(--shadow);overflow:hidden;margin-bottom:10px;}
  .cardHead{padding:12px 12px 10px;display:flex;align-items:center;justify-content:space-between;gap:10px;}
  .name{font-weight:900;font-size:15px;}
  .sub{color:var(--muted);font-size:12px;}
  .badge{padding:5px 8px;border-radius:999px;font-size:12px;background:rgba(124,242,255,.10);border:1px solid rgba(124,242,255,.20);}
  .controls{padding:10px 12px 12px;border-top:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;gap:10px;}
  select{border:0;outline:none;color:var(--text);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:10px 12px;font-size:15px;}
  .sexBlock{display:flex;gap:10px;width:100%;}
  .sexCard{flex:1;border-radius:16px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);padding:10px;}
  .sexTop{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
  .sexLabel{font-weight:900;font-size:13px;}
  .sexLabel span{opacity:.75;font-weight:600;margin-left:6px;}
  .count{font-variant-numeric:tabular-nums;font-size:20px;font-weight:900;}
  .btnRow{display:flex;gap:10px;}
  .btn{flex:1;height:42px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.08);color:var(--text);font-size:22px;font-weight:900;}
  .btn.plus{color:var(--accent);border-color:rgba(124,242,255,.25);}
  .disabled{opacity:.35;pointer-events:none;}
  .sheet{border-radius:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);padding:10px;}
  .sheetTop{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;}
  textarea{width:100%;height:220px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.22);color:var(--text);padding:12px;font-size:13px;line-height:1.55;outline:none;resize:none;}
  .total{font-size:13px;color:var(--muted);} .total b{color:var(--good);}
  .bottomBar{position:fixed;left:0;right:0;bottom:0;z-index:80;padding:10px 12px;padding-bottom:calc(10px + env(safe-area-inset-bottom));
    background:linear-gradient(to top, rgba(11,12,16,.92), rgba(11,12,16,.25));backdrop-filter:blur(18px);border-top:1px solid rgba(255,255,255,.06);}
  .barRow{display:flex;gap:10px;}
  .action{flex:1;height:48px;border-radius:16px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.08);color:var(--text);font-size:16px;font-weight:900;}
  .action.primary{background:linear-gradient(180deg, rgba(124,242,255,.25), rgba(124,242,255,.10));border-color:rgba(124,242,255,.28);}
</style>
</head>
<body>

<div class="top">
  <div class="title">
    <h1>ğŸ¦– æç«œè²©å£²ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</h1>
    <div class="pill">iPhoneæœ€é©åŒ– / Â±å…¥åŠ› / è‡ªå‹•æ•´å½¢</div>
  </div>
  <div class="searchRow">
    <div class="search"><span style="opacity:.7">ğŸ”</span>
      <input id="q" placeholder="æç«œåã§æ¤œç´¢" oninput="render()"/>
    </div>
    <label class="toggle"><input id="onlyNonZero" type="checkbox" onchange="render()"/>0ã‚’éš ã™</label>
  </div>
</div>

<div class="wrap" id="list"></div>

<div class="wrap">
  <div class="sheet">
    <div class="sheetTop">
      <div class="sub">å‡ºåŠ›</div>
      <div class="total">åˆè¨ˆ: <b id="totalView">0å††</b></div>
    </div>
    <textarea id="result" readonly placeholder="ä¸‹ã®ã€Œç”Ÿæˆã€ã§æ–‡ç« ãŒå‡ºã¾ã™"></textarea>
  </div>
</div>

<div class="bottomBar">
  <div class="barRow">
    <button class="action primary" onclick="generate()">ç”Ÿæˆ</button>
    <button class="action" onclick="copyText()">ã‚³ãƒ”ãƒ¼</button>
  </div>
</div>

<script>
  const prices = {"å—ç²¾åµ":30,"å—ç²¾åµ(æŒ‡å®š)":50,"å¹¼ä½“":100,"èƒš":50,"èƒš(æŒ‡å®š)":100,"æˆä½“":500};
  const sexTypes = new Set(["å—ç²¾åµ(æŒ‡å®š)","èƒš(æŒ‡å®š)","å¹¼ä½“","æˆä½“"]);

  let dinos = [];
  const state = new Map();

  function yen(n){ return `${Number(n).toLocaleString("ja-JP")}å††`; }

  async function loadDinos(){
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼ˆæ›´æ–°ãŒåæ˜ ã•ã‚Œãªã„äº‹æ•…é˜²æ­¢ï¼‰
    const res = await fetch(`dinos.txt?ts=${Date.now()}`);
    const text = await res.text();
    dinos = text
      .split(/\r?\n/)
      .map(s => s.trim().replace(/^ãƒ»\s*/,""))
      .filter(Boolean);
    dinos.forEach(d => state.set(d, {type:"å—ç²¾åµ", m:0, f:0}));
    render();
  }

  function applyInputMode(card, type){
    const femaleCard = card.querySelector(".femaleCard");
    const maleLabel = card.querySelector(".maleLabel");
    const femaleLabel = card.querySelector(".femaleLabel");
    if (sexTypes.has(type)){
      femaleCard.classList.remove("disabled");
      maleLabel.innerHTML = "â™‚ <span>ã‚ªã‚¹</span>";
      femaleLabel.innerHTML = "â™€ <span>ãƒ¡ã‚¹</span>";
    } else {
      // æ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ï¼šåˆç®—å…¥åŠ›ï¼ˆâ™‚å´ã ã‘ä½¿ã†ï¼‰
      femaleCard.classList.add("disabled");
      maleLabel.innerHTML = "å€‹æ•° <span>åˆç®—</span>";
      femaleLabel.innerHTML = "â™€ <span>ï¼ˆæœªä½¿ç”¨ï¼‰</span>";
      // å¿µã®ãŸã‚â™€ã¯0ã«å¯„ã›ã‚‹ï¼ˆå€¤ãŒæ®‹ã£ã¦èª¤è§£ã™ã‚‹ã®ã‚’é˜²ãï¼‰
      const name = card.dataset.name;
      const s = state.get(name);
      s.f = 0;
      card.querySelector(".f").textContent = "0";
    }
  }

  function render(){
    const q = (document.getElementById("q").value || "").trim();
    const onlyNonZero = document.getElementById("onlyNonZero").checked;
    const root = document.getElementById("list");
    root.innerHTML = "";

    dinos.forEach(name => {
      if (q && !name.includes(q)) return;

      const s = state.get(name);
      const qty = s.m + s.f;
      if (onlyNonZero && qty === 0) return;

      const card = document.createElement("div");
      card.className = "card";
      card.dataset.name = name;
      card.innerHTML = `
        <div class="cardHead">
          <div>
            <div class="name">${name}</div>
            <div class="sub">ã‚¿ã‚¤ãƒ—ã§è¡¨è¨˜ãŒè‡ªå‹• / Â±ã®ã¿</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
            <div class="badge">${s.type}</div>
            <div class="sub">å˜ä¾¡ ${yen(prices[s.type]||0)}</div>
          </div>
        </div>
        <div class="controls">
          <div class="row1">
            <select class="type">
              <option ${s.type==="å—ç²¾åµ"?"selected":""}>å—ç²¾åµ</option>
              <option ${s.type==="å—ç²¾åµ(æŒ‡å®š)"?"selected":""}>å—ç²¾åµ(æŒ‡å®š)</option>
              <option ${s.type==="å¹¼ä½“"?"selected":""}>å¹¼ä½“</option>
              <option ${s.type==="èƒš"?"selected":""}>èƒš</option>
              <option ${s.type==="èƒš(æŒ‡å®š)"?"selected":""}>èƒš(æŒ‡å®š)</option>
              <option ${s.type==="æˆä½“"?"selected":""}>æˆä½“</option>
            </select>
          </div>
          <div class="sexBlock">
            <div class="sexCard maleCard">
              <div class="sexTop"><div class="sexLabel maleLabel">â™‚ <span>ã‚ªã‚¹</span></div><div class="count m">${s.m}</div></div>
              <div class="btnRow">
                <button class="btn" type="button" data-d="-1" data-sex="m">âˆ’</button>
                <button class="btn plus" type="button" data-d="1" data-sex="m">ï¼‹</button>
              </div>
            </div>
            <div class="sexCard femaleCard">
              <div class="sexTop"><div class="sexLabel femaleLabel">â™€ <span>ãƒ¡ã‚¹</span></div><div class="count f">${s.f}</div></div>
              <div class="btnRow">
                <button class="btn" type="button" data-d="-1" data-sex="f">âˆ’</button>
                <button class="btn plus" type="button" data-d="1" data-sex="f">ï¼‹</button>
              </div>
            </div>
          </div>
        </div>
      `;
      root.appendChild(card);

      // type change
      const sel = card.querySelector(".type");
      sel.addEventListener("change", () => {
        const st = state.get(name);
        st.type = sel.value;
        card.querySelector(".badge").textContent = st.type;
        card.querySelector(".sub").textContent = `å˜ä¾¡ ${yen(prices[st.type]||0)}`;
        applyInputMode(card, st.type);
      });

      // +/- buttons
      card.querySelectorAll("button[data-sex]").forEach(b => {
        b.addEventListener("click", () => {
          const st = state.get(name);
          const sex = b.dataset.sex;
          const d = Number(b.dataset.d);

          // æ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ã¯ã€Œmã®ã¿ã€ã‚’åˆç®—ã‚«ã‚¦ãƒ³ã‚¿ã¨ã—ã¦ä½¿ã†
          if (!sexTypes.has(st.type) && sex === "f") return;

          st[sex] = Math.max(0, st[sex] + d);
          card.querySelector("." + sex).textContent = st[sex];
        });
      });

      applyInputMode(card, s.type);
    });
  }

  function formatLine(type, m, f){
    // æ€§åˆ¥è¡¨è¨˜ã‚¿ã‚¤ãƒ—
    if (sexTypes.has(type)){
      const parts = [];
      if (m>0) parts.push(`â™‚Ã—${m}`);
      if (f>0) parts.push(`â™€Ã—${f}`);
      return `${type} ${parts.join(" ")}`.trim();
    }
    // æ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ï¼ˆåˆç®—ï¼‰
    const qty = m + f;
    if (type === "å—ç²¾åµ" && m === f && m > 0){
      // âœ… ãƒšã‚¢åˆ¤å®šï¼ˆã“ã“ãŒä»Šå›ã®ä¿®æ­£ã®è‚ï¼‰
      return `å—ç²¾åµãƒšã‚¢${m > 1 ? "Ã—" + m : ""}`;
    }
    return `${type}Ã—${qty}`;
  }

  function generate(){
    let lines = [];
    let total = 0;
    let idx = 1;

    dinos.forEach(name => {
      const s = state.get(name);
      if (!s) return;

      // æ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ã¯mãŒåˆç®—ã‚«ã‚¦ãƒ³ã‚¿ã€fã¯å¸¸ã«0
      const type = s.type;
      const m = s.m;
      const f = sexTypes.has(type) ? s.f : 0;
      const qty = m + f;
      if (qty === 0) return;

      const price = (prices[type] || 0) * qty;
      total += price;

      lines.push(`${idx}. ${name} ${formatLine(type, m, f)} = ${price}å††`);
      idx++;
    });

    document.getElementById("totalView").textContent = yen(total);

    document.getElementById("result").value =
`ã“ã®åº¦ã¯ã”æ¤œè¨ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
ã”å¸Œæœ›å†…å®¹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ğŸ‘‡ğŸ»

${lines.join("\n")}
ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
è¨ˆï¼š${total}å††
æœ€çŸ­ç´å“ç›®å®‰ : å³ç´å“å¯èƒ½

ã”å¸Œæœ›å†…å®¹ã€é‡‘é¡ã‚’ã”ç¢ºèªã®ä¸Šè³¼å…¥ã®æ–¹ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ğŸ™ğŸ»

ã¾ãŸã€è¿½åŠ ã‚„å¤‰æ›´ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ğŸ‘ğŸ»`;
  }

  async function copyText(){
    const text = document.getElementById("result").value;
    if (!text) return alert("å…ˆã«ã€Œç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
    try{
      await navigator.clipboard.writeText(text);
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }catch(e){
      // iOSã§ç¨€ã«å¤±æ•—ã™ã‚‹ãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const ta = document.getElementById("result");
      ta.focus(); ta.select();
      document.execCommand("copy");
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }
  }

  loadDinos();
</script>

</body>
</html>
