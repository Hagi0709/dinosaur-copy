<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>恐竜販売コピー生成</title>

<style>
:root{
  --bg:#0b0f14;
  --card:#141a22;
  --stroke:rgba(255,255,255,.08);
  --txt:#fff;
  --mut:rgba(255,255,255,.6);
  --male:#74d7ff;
  --female:#ff86c8;
  --ok:#78ffb3;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
  background:var(--bg);
  color:var(--txt);
  padding-bottom:120px;
}

.top{
  position:sticky;
  top:0;
  z-index:10;
  padding:10px;
  background:rgba(11,15,20,.95);
  backdrop-filter:blur(14px);
  border-bottom:1px solid var(--stroke);
}

.row{
  display:flex;
  gap:8px;
  align-items:center;
}

.search{
  flex:1;
  background:#1b2330;
  border-radius:14px;
  padding:8px 10px;
  display:flex;
  align-items:center;
  gap:6px;
}

.search input{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  outline:none;
  font-size:14px;
}

.qClear{
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:18px;
  line-height:24px;
  padding:0;
  display:none;
}

.total{
  font-size:13px;
}
.total b{
  color:var(--ok);
  font-size:15px;
}

.copy{
  background:#1b2330;
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:8px 12px;
  color:#fff;
  font-weight:700;
}

textarea{
  width:100%;
  margin-top:8px;
  height:110px;
  border-radius:14px;
  background:#0f141c;
  border:1px solid var(--stroke);
  color:#fff;
  padding:10px;
  font-size:12px;
  resize:none;
}

.list{
  padding:12px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:12px;
  margin-bottom:10px;
  border:1px solid var(--stroke);
}

.head{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.badge{
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
  background:#1b2330;
  border:1px solid var(--stroke);
}

.price{
  font-size:12px;
  color:var(--mut);
  margin-top:2px;
}

.controls{
  margin-top:10px;
}

select{
  width:100%;
  padding:8px;
  border-radius:12px;
  background:#1b2330;
  border:1px solid var(--stroke);
  color:#fff;
}

.sexrow{
  display:flex;
  gap:8px;
  margin-top:10px;
}

.sex{
  flex:1;
  padding:8px;
  border-radius:14px;
  border:2px solid;
}

.sex.m{border-color:var(--male)}
.sex.f{border-color:var(--female)}

.sexhead{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  font-weight:700;
}

.btns{
  display:flex;
  gap:8px;
  margin-top:6px;
}

.btn{
  flex:1;
  height:36px;
  border-radius:10px;
  background:#1b2330;
  border:1px solid var(--stroke);
  color:#fff;
  font-size:18px;
  font-weight:800;
}
</style>
</head>

<body>

<div class="top">
  <div class="row">
    <div class="search">
      <input id="q" placeholder="検索（ひらがなOK）">
      <button id="qClear" class="qClear" type="button">×</button>
    </div>
    <div class="total">合計 <b id="total">0円</b></div>
    <button class="copy" id="copy">コピー</button>
  </div>
  <textarea id="out" readonly></textarea>
</div>

<div class="list" id="list"></div>

<script>
const prices={
  "受精卵":30,
  "受精卵(指定)":50,
  "幼体":100,
  "胚":50,
  "胚(指定)":100,
  "成体":500
};

const pairTypes=new Set(["受精卵","胚","幼体","成体"]);
const dinos=[];
const state=new Map();

function hira(s){
  return s.replace(/[\u30a1-\u30f6]/g,c=>String.fromCharCode(c.charCodeAt(0)-0x60))
          .toLowerCase().replace(/[^\w]/g,"");
}

function displayType(t){
  return String(t).replace("(指定)","");
}

async function load(){
  const t=await fetch("dinos.txt").then(r=>r.text());
  t.split(/\r?\n/).forEach(d=>{
    d=d.replace(/^・/,"").trim();
    if(d){
      dinos.push(d);
      state.set(d,{type:"受精卵",m:0,f:0});
    }
  });
  render();
  update();
}

function render(){
  const list=document.getElementById("list");
  list.innerHTML="";
  dinos.forEach(name=>{
    const s=state.get(name);
    const card=document.createElement("div");
    card.className="card";
    card.dataset.key=hira(name);
    card.innerHTML=`
      <div class="head">
        <div><b>${name}</b></div>
        <div>
          <div class="badge">${displayType(s.type)}</div>
          <div class="price">単価 ${prices[s.type].toLocaleString("ja-JP")}円</div>
        </div>
      </div>
      <div class="controls">
        <select>
          ${Object.keys(prices).map(t=>`<option ${t===s.type?"selected":""}>${t}</option>`).join("")}
        </select>
        <div class="sexrow">
          <div class="sex m">
            <div class="sexhead"><span>♂</span><span class="mc">${s.m}</span></div>
            <div class="btns">
              <button class="btn" data-s="m" data-d="-1">−</button>
              <button class="btn" data-s="m" data-d="1">＋</button>
            </div>
          </div>
          <div class="sex f">
            <div class="sexhead"><span>♀</span><span class="fc">${s.f}</span></div>
            <div class="btns">
              <button class="btn" data-s="f" data-d="-1">−</button>
              <button class="btn" data-s="f" data-d="1">＋</button>
            </div>
          </div>
        </div>
      </div>
    `;
    list.appendChild(card);

    const sel=card.querySelector("select");
    sel.onchange=()=>{s.type=sel.value; render();};

    card.querySelectorAll(".btn").forEach(b=>{
      b.onclick=()=>{
        const sex=b.dataset.s;
        s[sex]=Math.max(0,s[sex]+Number(b.dataset.d));
        render();
      };
    });
  });
}

function formatLine(name,s){
  const qty=s.m+s.f;
  if(qty===0)return "";

  const unit=prices[s.type];
  const price=unit*qty;
  const t=displayType(s.type);

  if(pairTypes.has(t)&&s.m===s.f&&s.m>0){
    const p=s.m;
    return `${name}${t}ペア${p>1?"×"+p:""} = ${price.toLocaleString("ja-JP")}円`;
  }
  return `${name}${t}×${qty} = ${price.toLocaleString("ja-JP")}円`;
}

function update(){
  let lines=[],sum=0,idx=1;
  dinos.forEach(d=>{
    const s=state.get(d);
    const q=s.m+s.f;
    if(q===0)return;
    sum+=prices[s.type]*q;
    lines.push(`${idx}. ${formatLine(d,s)}`);
    idx++;
  });

  document.getElementById("out").value=
`この度はご検討いただきありがとうございます！

${lines.join("\n")}
--------------------
計：${sum.toLocaleString("ja-JP")}円
最短納品目安：即納可能`;

  document.getElementById("total").textContent=sum.toLocaleString("ja-JP")+"円";
}

const q=document.getElementById("q");
const qClear=document.getElementById("qClear");

function applyFilter(){
  const v=hira(q.value);
  qClear.style.display=v?"":"none";
  document.querySelectorAll(".card").forEach(c=>{
    c.style.display=c.dataset.key.includes(v)?"":"none";
  });
}

q.oninput=applyFilter;
qClear.onclick=()=>{q.value="";applyFilter();q.focus();};

document.getElementById("copy").onclick=()=>{
  navigator.clipboard.writeText(document.getElementById("out").value);
};

setInterval(update,100);
load();
</script>

</body>
</html>
