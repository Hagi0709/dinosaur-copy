<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width,
           initial-scale=1,
           maximum-scale=1,
           user-scalable=no,
           viewport-fit=cover">

<title>æç«œãƒªã‚¹ãƒˆ</title>

<!-- iPhone ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ -->
<link rel="apple-touch-icon" href="56379E4F-8771-431A-B2A6-4B3EE3136504.png">
<link rel="icon" href="56379E4F-8771-431A-B2A6-4B3EE3136504.png">

<style>
:root{
  --bg:#0b0f14;
  --txt:rgba(255,255,255,.92);
  --mut:rgba(255,255,255,.60);
  --ok:#78ffb3;
  --male:#74d7ff;
  --female:#ff86c8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
  background:var(--bg);
  color:var(--txt);
  padding-bottom:140px;
}
button,select,input{touch-action:manipulation}
input,button,select{font:inherit}

/* ===== top ===== */
.top{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(11,15,20,.95);
  backdrop-filter:blur(14px);
  padding:10px;
  padding-top:calc(10px + env(safe-area-inset-top));
  border-bottom:1px solid rgba(255,255,255,.06);
}
.row{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}
.search{
  flex:1;
  display:flex;
  align-items:center;
  gap:8px;
  height:36px;
  padding:0 10px;
  border-radius:14px;
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.12);
  min-width:0;
}
.search input{
  flex:1;
  border:0;
  background:transparent;
  color:var(--txt);
  font-size:14px;
  min-width:0;
  outline:none;
}
.qClear{
  width:26px;height:26px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  font-size:18px;
  color:#fff;
  display:inline-block; /* â† ã“ã‚Œã§å®‰å®šã•ã›ã‚‹ */
  line-height:1;
}
.delivery,.copy{
  height:36px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.08);
  color:#fff;
  padding:0 12px;
}
.copy{font-weight:900}
.total{
  margin-left:auto;
  font-size:14px;
  color:var(--ok);
  font-weight:900;
  white-space:nowrap;
}
textarea{
  width:100%;
  margin-top:8px;
  height:120px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  color:#fff;
  padding:10px;
  font-size:12px;
  line-height:1.45;
  outline:none;
}

/* ===== tabs ===== */
.tabs{
  display:flex;
  gap:10px;
  padding:10px;
  padding-top:0;
}
.tab{
  flex:1;
  height:40px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-weight:900;
}
.tab.active{
  background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.07));
  border-color:rgba(255,255,255,.16);
}

/* ===== list ===== */
.list{padding:12px}
.card{
  background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  margin-bottom:10px;
  overflow:hidden;
}
.card .pad{padding:12px}

/* è‡ªå‹•æŠ˜ã‚Šç•³ã¿ï¼ˆæœªå…¥åŠ›ï¼‰ */
.card.collapsed .body{display:none}

.head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.name{font-weight:900}
.right{
  text-align:right;
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:120px;
}
select.type{
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  color:#fff;
  font-size:12px;
  outline:none;
}
.unit{font-size:12px;color:var(--mut)}
/* ã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ—é ˜åŸŸ */
.tap{
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}

/* ===== steppers ===== */
.body{border-top:1px solid rgba(255,255,255,.08)}
.sexrow{
  display:flex;
  gap:10px;
  padding:12px;
}
.sex{
  flex:1;
  padding:8px;
  border-radius:14px;
  border:2px solid rgba(255,255,255,.10);
}
.sex.m{
  border-color:rgba(116,215,255,.45);
  background:rgba(116,215,255,.14);
}
.sex.f{
  border-color:rgba(255,134,200,.45);
  background:rgba(255,134,200,.14);
}
.stepper{
  display:flex;
  align-items:center;
  gap:10px;
}
.btn{
  width:46px;
  height:32px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.10);
  color:#fff;
  font-size:18px;
  font-weight:900;
  line-height:1;
}
.val{
  flex:1;
  text-align:center;
  font-weight:900;
  font-size:16px;
  letter-spacing:.2px;
  color:rgba(255,255,255,.92);
}

/* ===== items ===== */
.itemRow{
  padding:12px;
}
.itemStepper{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:10px;
}
.itemStepper .btn{height:34px}
.itemStepper .val{font-size:16px}

.hide{display:none !important}
</style>
</head>

<body>

<div class="top">
  <div class="row">
    <div class="search">
      <input id="q" placeholder="æ¤œç´¢">
      <button id="qClear" class="qClear" type="button">Ã—</button>
    </div>

    <select id="delivery" class="delivery">
      <option value="å³ç´å“å¯èƒ½">å³ç´å“å¯èƒ½</option>
      <option value="æœ¬æ—¥å¤œ">æœ¬æ—¥å¤œ</option>
    </select>

    <button id="copy" class="copy" type="button">ã‚³ãƒ”ãƒ¼</button>
    <div id="total" class="total">0å††</div>
  </div>

  <textarea id="out" readonly></textarea>

  <div class="tabs">
    <button id="tabDino" class="tab active" type="button">æç«œ</button>
    <button id="tabItem" class="tab" type="button">ã‚¢ã‚¤ãƒ†ãƒ </button>
  </div>
</div>

<div class="list" id="listDino"></div>
<div class="list hide" id="listItem"></div>

<script>
/* =========================
   å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
========================= */
function yen(n){return n.toLocaleString("ja-JP")+"å††"}
function toKatakana(s){
  return (s||"").replace(/[ã-ã‚–]/g, ch =>
    String.fromCharCode(ch.charCodeAt(0) + 0x60)
  );
}
function norm(s){
  return toKatakana((s||"").trim()).replace(/[ ã€€]/g,"");
}

/* =========================
   ãƒ‡ãƒ¼ã‚¿å®šç¾©
========================= */
const dinoPrices={
  "å—ç²¾åµ":30,"å—ç²¾åµ(æŒ‡å®š)":50,
  "å¹¼ä½“":100,"èƒš":50,"èƒš(æŒ‡å®š)":100,"æˆä½“":500,
  "ã‚¯ãƒ­ãƒ¼ãƒ³":500,"ã‚¯ãƒ­ãƒ¼ãƒ³(æŒ‡å®š)":300
};

/* â™‚â™€ã‚’ä½¿ã†/ãƒšã‚¢è¡¨è¨˜ã™ã‚‹ã‚¿ã‚¤ãƒ— */
const dinoPairTypes=new Set([
  "å—ç²¾åµ(æŒ‡å®š)","èƒš(æŒ‡å®š)","å¹¼ä½“","æˆä½“","ã‚¯ãƒ­ãƒ¼ãƒ³","ã‚¯ãƒ­ãƒ¼ãƒ³(æŒ‡å®š)"
]);

/* ã€Œä¸¡æ–¹å…¥åŠ›ã•ã‚ŒãŸã‚‰(æŒ‡å®š)ã¸ã€å¯¾è±¡ */
const autoSpecifyMap = {
  "å—ç²¾åµ":"å—ç²¾åµ(æŒ‡å®š)",
  "èƒš":"èƒš(æŒ‡å®š)",
  "ã‚¯ãƒ­ãƒ¼ãƒ³":"ã‚¯ãƒ­ãƒ¼ãƒ³(æŒ‡å®š)"
};
const autoUnspecifyMap = {
  "å—ç²¾åµ(æŒ‡å®š)":"å—ç²¾åµ",
  "èƒš(æŒ‡å®š)":"èƒš",
  "ã‚¯ãƒ­ãƒ¼ãƒ³(æŒ‡å®š)":"ã‚¯ãƒ­ãƒ¼ãƒ³"
};

/* items: name | unit | price */
const items=[];          // [{name, unit, price}]
const itemState=new Map();// name -> {qty, card, unit, price}

const dinos=[];          // name[]
const dinoState=new Map();// name -> {type,m,f,card,open}

/* =========================
   DOM
========================= */
const listDinoEl=document.getElementById("listDino");
const listItemEl=document.getElementById("listItem");
const outEl=document.getElementById("out");
const totalEl=document.getElementById("total");
const qEl=document.getElementById("q");
const qClear=document.getElementById("qClear");
const deliveryEl=document.getElementById("delivery");
const copyBtn=document.getElementById("copy");
const tabDino=document.getElementById("tabDino");
const tabItem=document.getElementById("tabItem");

let activeTab="dino"; // 'dino' | 'item'

/* =========================
   å‡ºåŠ›ï¼ˆæç«œâ†’ã‚¢ã‚¤ãƒ†ãƒ ã®é †ã§é€£çµï¼‰
========================= */
function formatDinoLine(name, s){
  const qty=s.m+s.f;
  if(qty<=0) return null;

  const unitPrice=(dinoPrices[s.type]||0);
  const price=unitPrice*qty;

  // "(æŒ‡å®š)" ã¯å‡ºåŠ›ã—ãªã„
  const t=s.type.replace("(æŒ‡å®š)","");
  let line="";

  if(dinoPairTypes.has(s.type)){
    if(s.m===s.f && s.m>0){
      line = `${name}${t}ãƒšã‚¢${s.m>1?("Ã—"+s.m):""} = ${price.toLocaleString("ja-JP")}å††`;
    }else{
      const parts=[];
      if(s.m>0) parts.push(`â™‚Ã—${s.m}`);
      if(s.f>0) parts.push(`â™€Ã—${s.f}`);
      line = `${name}${t}${parts.length?(" "+parts.join(" ")):""} = ${price.toLocaleString("ja-JP")}å††`;
    }
  }else{
    // ã“ã“ã«æ¥ã‚‹ã®ã¯åŸºæœ¬ã€Œå—ç²¾åµ/èƒš/ã‚¯ãƒ­ãƒ¼ãƒ³ã®éæŒ‡å®š + ç‰‡å´å…¥åŠ›ã®ã¿ã€ãªã©
    line = `${name}${t}Ã—${qty} = ${price.toLocaleString("ja-JP")}å††`;
  }
  return {line, price};
}

function formatItemLine(it){
  const s=itemState.get(it.name);
  if(!s || s.qty<=0) return null;

  const count = s.qty * s.unit;   // è¡¨ç¤ºå€‹æ•°
  const price = s.qty * s.price;  // åˆè¨ˆé‡‘é¡ï¼ˆä¾¡æ ¼ã¯ã€Œå…¥åŠ›1å›ã‚ãŸã‚Šã€ï¼‰
  const line = `${it.name}Ã—${count} = ${price.toLocaleString("ja-JP")}å††`;
  return {line, price};
}

function rebuild(){
  let lines=[], sum=0, idx=1;

  // æç«œ
  dinos.forEach(name=>{
    const s=dinoState.get(name);
    if(!s) return;

    const qty=s.m+s.f;

    // æœªå…¥åŠ›ã‚«ãƒ¼ãƒ‰ã¯è‡ªå‹•ã§ç•³ã‚€ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ open ã‚’ç«‹ã¦ã¦ã¦ã‚‚ qty=0 ãªã‚‰ç•³ã‚€ï¼‰
    if(qty===0){
      s.open=false;
      s.card.classList.add("collapsed");
      return;
    }

    // å…¥åŠ›ãŒã‚ã‚‹ãªã‚‰ open çŠ¶æ…‹ã«å¾“ã†ï¼ˆå‹æ‰‹ã«é–‰ã˜ãªã„ï¼‰
    s.card.classList.toggle("collapsed", !s.open);

    const r=formatDinoLine(name,s);
    if(!r) return;
    lines.push(`${idx}. ${r.line}`);
    idx++;
    sum+=r.price;
  });

  // ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆæç«œã®å¾Œã«ç¶šã‘ã¦ï¼‰
  items.forEach(it=>{
    const r=formatItemLine(it);
    if(!r) return;

    // ã‚¢ã‚¤ãƒ†ãƒ ã¯ã€Œæœªå…¥åŠ›ãªã‚‰ç•³ã‚€ã€çš„ãªUIã¯ç„¡ã—ï¼ˆå¿…è¦ãªã‚‰å¾Œã§è¿½åŠ å¯ï¼‰
    lines.push(`${idx}. ${r.line}`);
    idx++;
    sum+=r.price;
  });

  totalEl.textContent=yen(sum);

  outEl.value=
`ã“ã®åº¦ã¯ã”æ¤œè¨ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
ã”å¸Œæœ›å†…å®¹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ğŸ‘‡ğŸ»

${lines.join("\n")}
ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
è¨ˆï¼š${sum.toLocaleString("ja-JP")}å††
æœ€çŸ­ç´å“ç›®å®‰ : ${deliveryEl.value}

ã”å¸Œæœ›å†…å®¹ã€é‡‘é¡ã‚’ã”ç¢ºèªã®ä¸Šè³¼å…¥ã®æ–¹ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ğŸ™ğŸ»

ã¾ãŸã€è¿½åŠ ã‚„å¤‰æ›´ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ğŸ‘ğŸ»`;
}

/* =========================
   æ¤œç´¢ï¼ˆå®‰å®šç‰ˆï¼‰
   - activeTab ã®ãƒªã‚¹ãƒˆã ã‘çµã‚Šè¾¼ã¿
   - ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠæ­£è¦åŒ–
   - ã‚¿ãƒ–åˆ‡æ›¿æ™‚ã‚‚æ¤œç´¢ã‚’å†é©ç”¨
========================= */
function applySearch(){
  const q = norm(qEl.value);

  if(activeTab==="dino"){
    dinos.forEach(n=>{
      const card=dinoState.get(n)?.card;
      if(!card) return;
      const hit = (q==="") ? true : norm(n).includes(q);
      card.style.display = hit ? "" : "none";

      // æ¤œç´¢ã§ãƒ’ãƒƒãƒˆã—ãªã„ã‚«ãƒ¼ãƒ‰ã¯ã€è¡¨ç¤ºã•ã‚Œãªã„ã®ã§ open çŠ¶æ…‹ã¯è§¦ã‚‰ãªã„ï¼ˆå‹æ‰‹ã«ç•³ã¾ãªã„ï¼‰
    });
  }else{
    items.forEach(it=>{
      const s=itemState.get(it.name);
      if(!s) return;
      const hit = (q==="") ? true : norm(it.name).includes(q);
      s.card.style.display = hit ? "" : "none";
    });
  }
}

/* ã‚¯ãƒªã‚¢ */
qEl.addEventListener("input", applySearch);
qClear.addEventListener("click", ()=>{
  qEl.value="";
  applySearch();
});

/* =========================
   ã‚¿ãƒ–åˆ‡æ›¿
========================= */
function setTab(tab){
  activeTab=tab;
  tabDino.classList.toggle("active", tab==="dino");
  tabItem.classList.toggle("active", tab==="item");
  listDinoEl.classList.toggle("hide", tab!=="dino");
  listItemEl.classList.toggle("hide", tab!=="item");

  // åˆ‡æ›¿æ™‚ã«æ¤œç´¢ã‚’å†é©ç”¨ï¼ˆã“ã“ãŒæŠœã‘ã‚‹ã¨ã€Œæ¤œç´¢ãŒåŠ¹ã„ã¦ãªã„ã€ã«è¦‹ãˆã‚‹ï¼‰
  applySearch();
}
tabDino.addEventListener("click", ()=>setTab("dino"));
tabItem.addEventListener("click", ()=>setTab("item"));

/* =========================
   ã‚³ãƒ”ãƒ¼ï¼ˆæ¼”å‡ºã¤ãï¼‰
========================= */
copyBtn.addEventListener("click", ()=>{
  const t=outEl.value.trim();
  if(!t) return;
  navigator.clipboard.writeText(t).then(()=>{
    const prev = copyBtn.textContent;
    copyBtn.textContent="ã‚³ãƒ”ãƒ¼æ¸ˆã¿âœ“";
    copyBtn.disabled=true;
    setTimeout(()=>{
      copyBtn.textContent=prev;
      copyBtn.disabled=false;
    },1200);
  });
});

/* å³ç´ã®é¸æŠã‚‚å³åæ˜  */
deliveryEl.addEventListener("change", rebuild);

/* =========================
   dinos.txt ãƒ‘ãƒ¼ã‚¹
   - å½¢å¼: ãƒ»åå‰ | ã‚¿ã‚¤ãƒ—
========================= */
function parseDinoLine(line){
  line=(line||"").trim();
  if(!line) return null;
  if(line.startsWith("#")) return null;
  line=line.replace(/^ãƒ»/,"").trim();
  if(!line) return null;

  const parts=line.split("|");
  const name=(parts[0]||"").trim();
  const rawType=(parts[1]||"").trim();
  if(!name) return null;

  const defType = (rawType && (rawType in dinoPrices)) ? rawType : "å—ç²¾åµ";
  return {name, defType};
}

/* =========================
   items.txt ãƒ‘ãƒ¼ã‚¹
   - å½¢å¼: åå‰ | unit | price
========================= */
function parseItemLine(line){
  line=(line||"").trim();
  if(!line) return null;
  if(line.startsWith("#")) return null;

  const parts=line.split("|").map(s=>s.trim());
  if(parts.length<3) return null;

  const name=parts[0];
  const unit=parseInt(parts[1],10);
  const price=parseInt(parts[2],10);
  if(!name) return null;
  if(!Number.isFinite(unit) || unit<=0) return null;
  if(!Number.isFinite(price) || price<0) return null;

  return {name, unit, price};
}

/* =========================
   æç«œã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
========================= */
function createDinoCard(name, defType){
  const s={type:defType, m:0, f:0, open:false, card:null};
  dinoState.set(name, s);

  const card=document.createElement("div");
  s.card=card;
  card.className="card collapsed";

  card.innerHTML=`
    <div class="pad tap head">
      <div class="name">${name}</div>
      <div class="right">
        <select class="type">
          ${Object.keys(dinoPrices).map(t=>`<option value="${t}">${t.replace("(æŒ‡å®š)","")}</option>`).join("")}
        </select>
        <div class="unit">å˜ä¾¡${dinoPrices[defType]}å††</div>
      </div>
    </div>

    <div class="body">
      <div class="sexrow">
        <div class="sex m">
          <div class="stepper">
            <button class="btn" type="button" data-sex="m" data-d="-1">âˆ’</button>
            <div class="val mc">0</div>
            <button class="btn" type="button" data-sex="m" data-d="1">ï¼‹</button>
          </div>
        </div>

        <div class="sex f">
          <div class="stepper">
            <button class="btn" type="button" data-sex="f" data-d="-1">âˆ’</button>
            <div class="val fc">0</div>
            <button class="btn" type="button" data-sex="f" data-d="1">ï¼‹</button>
          </div>
        </div>
      </div>
    </div>
  `;
  listDinoEl.appendChild(card);

  const tap=card.querySelector(".tap");
  const sel=card.querySelector(".type");
  const unitEl=card.querySelector(".unit");
  const mc=card.querySelector(".mc");
  const fc=card.querySelector(".fc");

  // åˆæœŸåæ˜ ï¼ˆselectã¯è¡¨ç¤ºä¸Š "(æŒ‡å®š)" ã‚’æ¶ˆã—ã¦ã‚‹ã®ã§ value ã§ä¿æŒï¼‰
  sel.value = s.type;

  // ãƒ˜ãƒƒãƒ€ã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼ˆqty=0ã§ã‚‚OKï¼‰
  tap.addEventListener("click", (e)=>{
    // ã‚»ãƒ¬ã‚¯ãƒˆæ“ä½œã®ã‚¿ãƒƒãƒ—ãŒæŠ˜ã‚Šç•³ã¿ã«æ³¢åŠã—ãªã„ã‚ˆã†ã«
    if(e.target && (e.target.tagName==="SELECT")) return;

    s.open = !s.open;
    card.classList.toggle("collapsed", !s.open);
  });

  // ã‚¿ã‚¤ãƒ—å¤‰æ›´ï¼šã“ã“ã§ã¯ã€Œé–‹ã„ã¦ãŸã‚‰é–‰ã˜ãªã„ã€ï¼openã‚’è§¦ã‚‰ãªã„
  sel.addEventListener("change", ()=>{
    // è¡¨ç¤ºã®"(æŒ‡å®š)"ã¯æ¶ˆã—ã¦ã‚‹ãŒã€valueã¯å…ƒã®ã¾ã¾ãªã®ã§OK
    s.type = sel.value;
    unitEl.textContent = `å˜ä¾¡${dinoPrices[s.type]}å††`;

    // ã“ã“ã§å‹æ‰‹ã«æŠ˜ã‚Šç•³ã¿çŠ¶æ…‹ã¯å¤‰ãˆãªã„ï¼ˆé‡è¦ï¼‰
    rebuild();
  });

  // æ•°é‡å¢—æ¸›
  card.querySelectorAll(".btn").forEach(b=>{
    b.addEventListener("click", ()=>{
      const sex=b.dataset.sex;
      const d=Number(b.dataset.d);

      if(sex==="m") s.m=Math.max(0, s.m+d);
      if(sex==="f") s.f=Math.max(0, s.f+d);

      mc.textContent = s.m;
      fc.textContent = s.f;

      // ä¸¡æ–¹å…¥åŠ› â†’ è‡ªå‹•ã§(æŒ‡å®š)ã¸
      if(s.m>0 && s.f>0 && autoSpecifyMap[s.type]){
        s.type = autoSpecifyMap[s.type];
        sel.value = s.type;
        unitEl.textContent = `å˜ä¾¡${dinoPrices[s.type]}å††`;
      }

      // ä¸¡æ–¹0 â†’ è‡ªå‹•(æŒ‡å®š)è§£é™¤ï¼ˆæŒ‡å®šã‚¿ã‚¤ãƒ—ãªã‚‰æˆ»ã™ï¼‰
      if(s.m===0 && s.f===0 && autoUnspecifyMap[s.type]){
        s.type = autoUnspecifyMap[s.type];
        sel.value = s.type;
        unitEl.textContent = `å˜ä¾¡${dinoPrices[s.type]}å††`;
      }

      // æœªå…¥åŠ›â†’è‡ªå‹•ã§ç•³ã‚€ã€‚å…¥åŠ›ã‚ã‚Šâ†’åˆå›å…¥åŠ›ã§è‡ªå‹•ã‚ªãƒ¼ãƒ—ãƒ³ï¼ˆå…¥åŠ›ã§ããªã„å•é¡Œã®å›é¿ã«ã‚‚ãªã‚‹ï¼‰
      if(s.m+s.f>0){
        s.open = true;
        card.classList.remove("collapsed");
      }

      rebuild();
    });
  });
}

/* =========================
   ã‚¢ã‚¤ãƒ†ãƒ ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
========================= */
function createItemCard(it){
  items.push(it);

  const s={qty:0, unit:it.unit, price:it.price, card:null};
  itemState.set(it.name, s);

  const card=document.createElement("div");
  s.card=card;
  card.className="card";

  card.innerHTML=`
    <div class="pad">
      <div class="head">
        <div class="name">${it.name}</div>
        <div class="right">
          <div class="unit">å˜ä½${it.unit}</div>
          <div class="unit">å˜ä¾¡${it.price}å††</div>
        </div>
      </div>

      <div class="itemStepper">
        <button class="btn" type="button" data-d="-1">âˆ’</button>
        <div class="val qty">0</div>
        <button class="btn" type="button" data-d="1">ï¼‹</button>
      </div>
    </div>
  `;
  listItemEl.appendChild(card);

  const qtyEl=card.querySelector(".qty");
  card.querySelectorAll(".btn").forEach(b=>{
    b.addEventListener("click", ()=>{
      s.qty=Math.max(0, s.qty + Number(b.dataset.d));
      qtyEl.textContent=String(s.qty);
      rebuild();
    });
  });
}

/* =========================
   ãƒ­ãƒ¼ãƒ‰
========================= */
async function loadAll(){
  // dinos
  const dinoText = await fetch("dinos.txt?ts="+Date.now()).then(r=>r.text());
  dinoText.split(/\r?\n/)
    .map(parseDinoLine)
    .filter(Boolean)
    .forEach(({name, defType})=>{
      if(dinoState.has(name)) return; // é‡è¤‡ä¿é™º
      dinos.push(name);
      createDinoCard(name, defType);
    });

  // items
  const itemText = await fetch("items.txt?ts="+Date.now()).then(r=>r.text());
  itemText.split(/\r?\n/)
    .map(parseItemLine)
    .filter(Boolean)
    .forEach(it=>{
      if(itemState.has(it.name)) return; // é‡è¤‡ä¿é™º
      createItemCard(it);
    });

  rebuild();
  applySearch();
}
loadAll();
</script>

</body>
</html>