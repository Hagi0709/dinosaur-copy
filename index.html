<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ÊÅêÁ´úË≤©Â£≤„Ç≥„Éî„ÉºÁîüÊàê</title>

<style>
:root{
  --bg:#0b0f14;
  --card:#141a22;
  --stroke:rgba(255,255,255,.10);
  --txt:rgba(255,255,255,.92);
  --mut:rgba(255,255,255,.60);
  --male:#74d7ff;
  --female:#ff86c8;
  --ok:#78ffb3;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
  background:var(--bg);
  color:var(--txt);
  padding-bottom:120px;
}

/* top */
.top{
  position:sticky;
  top:0;
  z-index:20;
  padding:10px;
  padding-top:calc(10px + env(safe-area-inset-top));
  background:rgba(11,15,20,.95);
  backdrop-filter:blur(14px);
  border-bottom:1px solid rgba(255,255,255,.06);
}
.row{
  display:flex;
  gap:8px;
  align-items:center;
}
.search{
  flex:1;
  display:flex;
  align-items:center;
  gap:8px;
  height:36px;
  padding:0 10px;
  border-radius:14px;
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.12);
}
.search input{
  width:100%;
  border:0;
  outline:none;
  background:transparent;
  color:var(--txt);
  font-size:14px;
}
.qClear{
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:18px;
  line-height:24px;
  padding:0;
  display:inline-block; /* ‚Üê Â∏∏ÊôÇË°®Á§∫„ÅßÁ¢∫ÂÆö */
}
.total{
  font-size:12px;
  color:var(--mut);
}
.total b{
  color:var(--ok);
  font-size:14px;
}
.copy{
  height:36px;
  padding:0 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-weight:900;
}
textarea{
  width:100%;
  margin-top:8px;
  height:112px;
  resize:none;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  color:#fff;
  padding:10px 12px;
  font-size:12px;
  line-height:1.45;
}

/* list */
.list{padding:12px;}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  padding:12px;
  margin-bottom:10px;
}
.head{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.name{font-weight:900;}
.badge{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
}
.unit{font-size:12px;color:var(--mut);}
.controls{margin-top:10px;display:flex;flex-direction:column;gap:10px;}
select{
  padding:10px;
  border-radius:14px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  color:#fff;
}
.sexrow{display:flex;gap:10px;}
.sex{
  flex:1;
  padding:10px;
  border-radius:16px;
  border:2px solid rgba(255,255,255,.10);
}
.sex.m{border-color:var(--male);background:rgba(116,215,255,.16);}
.sex.f{border-color:var(--female);background:rgba(255,134,200,.16);}
.sexhead{display:flex;justify-content:space-between;font-weight:900;}
.btns{display:flex;gap:10px;margin-top:6px;}
.btn{
  flex:1;
  height:42px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-size:22px;
  font-weight:900;
}
.disabled{opacity:.35;pointer-events:none;}
</style>
</head>

<body>

<div class="top">
  <div class="row">
    <div class="search">
      <input id="q" placeholder="Ê§úÁ¥¢Ôºà„Å≤„Çâ„Åå„Å™OKÔºâ">
      <button id="qClear" class="qClear">√ó</button>
    </div>

    <div class="total">ÂêàË®à <b id="total">0ÂÜÜ</b></div>

    <select id="delivery">
      <option value="Âç≥Á¥çÂìÅÂèØËÉΩ">Âç≥Á¥çÂìÅÂèØËÉΩ</option>
      <option value="Êú¨Êó•Â§ú">Êú¨Êó•Â§ú</option>
    </select>

    <button id="copy" class="copy">„Ç≥„Éî„Éº</button>
  </div>

  <textarea id="out" readonly></textarea>
</div>

<div class="list" id="list"></div>

<script>
const prices={
  "ÂèóÁ≤æÂçµ":30,
  "ÂèóÁ≤æÂçµ(ÊåáÂÆö)":50,
  "Âπº‰Ωì":100,
  "ËÉö":50,
  "ËÉö(ÊåáÂÆö)":100,
  "Êàê‰Ωì":500
};

const sexTypes=new Set(["ÂèóÁ≤æÂçµ(ÊåáÂÆö)","ËÉö(ÊåáÂÆö)","Âπº‰Ωì","Êàê‰Ωì"]);
const pairTypes=new Set(["ÂèóÁ≤æÂçµ(ÊåáÂÆö)","ËÉö(ÊåáÂÆö)","Âπº‰Ωì","Êàê‰Ωì"]);

const dinos=[];
const state=new Map();
const ui=new Map();

const listEl=document.getElementById("list");
const outEl=document.getElementById("out");
const totalEl=document.getElementById("total");
const qEl=document.getElementById("q");
const qClearEl=document.getElementById("qClear");
const copyBtn=document.getElementById("copy");
const deliveryEl=document.getElementById("delivery");

deliveryEl.addEventListener("change", rebuildOutput);

function kataToHira(s){
  return s.replace(/[\u30A1-\u30F6]/g,c=>String.fromCharCode(c.charCodeAt(0)-0x60));
}
function normalize(s){
  return kataToHira(String(s)).toLowerCase().replace(/[\s„ÄÄ„Éª()ÔºàÔºâ]/g,"");
}
function displayType(t){return t.replace("(ÊåáÂÆö)","");}

function formatLine(name,s){
  const qty=s.m+s.f;
  const price=prices[s.type]*qty;
  const t=displayType(s.type);

  if(pairTypes.has(s.type)){
    if(s.m===s.f&&s.m>0){
      return `${name}${t}„Éö„Ç¢${s.m>1?"√ó"+s.m:""} = ${price.toLocaleString("ja-JP")}ÂÜÜ`;
    }
    const parts=[];
    if(s.m>0)parts.push(`‚ôÇ√ó${s.m}`);
    if(s.f>0)parts.push(`‚ôÄ√ó${s.f}`);
    return `${name}${t} ${parts.join(" ")} = ${price.toLocaleString("ja-JP")}ÂÜÜ`;
  }
  return `${name}${t}√ó${qty} = ${price.toLocaleString("ja-JP")}ÂÜÜ`;
}

function rebuildOutput(){
  let sum=0,idx=1,lines=[];
  dinos.forEach(d=>{
    const s=state.get(d);
    const q=s.m+s.f;
    if(!q)return;
    sum+=prices[s.type]*q;
    lines.push(`${idx}. ${formatLine(d,s)}`);
    idx++;
  });
  totalEl.textContent=sum.toLocaleString("ja-JP")+"ÂÜÜ";
  outEl.value=
`„Åì„ÅÆÂ∫¶„ÅØ„ÅîÊ§úË®é„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ
„ÅîÂ∏åÊúõÂÜÖÂÆπ„ÅØ‰ª•‰∏ã„Å®„Å™„Çä„Åæ„Åôüëáüèª

${lines.join("\n")}
„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº„Éº
Ë®àÔºö${sum.toLocaleString("ja-JP")}ÂÜÜ
ÊúÄÁü≠Á¥çÂìÅÁõÆÂÆâ : ${deliveryEl.value}

„ÅîÂ∏åÊúõÂÜÖÂÆπ„ÄÅÈáëÈ°ç„Çí„ÅîÁ¢∫Ë™ç„ÅÆ‰∏äË≥ºÂÖ•„ÅÆÊñπ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åôüôèüèª

„Åæ„Åü„ÄÅËøΩÂä†„ÇÑÂ§âÊõ¥„Å™„Å©„ÅÇ„Çä„Åæ„Åó„Åü„Çâ„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäÁî≥„Åó‰ªò„Åë„Åè„Å†„Åï„ÅÑüëçüèª`;
}

function applySearch(){
  const q=normalize(qEl.value);
  dinos.forEach(d=>{
    const ref=ui.get(d);
    ref.card.style.display=!q||ref.norm.includes(q)?"":"none";
  });
}

qEl.oninput=applySearch;
qClearEl.onclick=()=>{qEl.value="";applySearch();qEl.focus();};

copyBtn.onclick=async()=>{
  await navigator.clipboard.writeText(outEl.value);
  const t=copyBtn.textContent;
  copyBtn.textContent="„Ç≥„Éî„ÉºÊ∏à„Åø ‚úì";
  setTimeout(()=>copyBtn.textContent=t,1200);
};

async function load(){
  const t=await fetch("dinos.txt?"+Date.now()).then(r=>r.text());
  t.split(/\r?\n/).forEach(d=>{
    d=d.replace(/^„Éª/,"").trim();
    if(d){
      dinos.push(d);
      state.set(d,{type:"ÂèóÁ≤æÂçµ",m:0,f:0});
    }
  });
  render();
}

function render(){
  listEl.innerHTML="";
  dinos.forEach(name=>{
    const s=state.get(name);
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="head">
        <div class="name">${name}</div>
        <div>
          <div class="badge">${displayType(s.type)}</div>
          <div class="unit">Âçò‰æ° ${prices[s.type]}ÂÜÜ</div>
        </div>
      </div>
      <div class="controls">
        <select>
          ${Object.keys(prices).map(t=>`<option ${t===s.type?"selected":""}>${t}</option>`).join("")}
        </select>
        <div class="sexrow">
          <div class="sex m">
            <div class="sexhead"><span>‚ôÇ</span><span class="mc">${s.m}</span></div>
            <div class="btns">
              <button class="btn" data-s="m" data-d="-1">‚àí</button>
              <button class="btn" data-s="m" data-d="1">Ôºã</button>
            </div>
          </div>
          <div class="sex f">
            <div class="sexhead"><span>‚ôÄ</span><span class="fc">${s.f}</span></div>
            <div class="btns">
              <button class="btn" data-s="f" data-d="-1">‚àí</button>
              <button class="btn" data-s="f" data-d="1">Ôºã</button>
            </div>
          </div>
        </div>
      </div>`;
    listEl.appendChild(card);
    ui.set(name,{card,norm:normalize(name)});
    const sel=card.querySelector("select");
    sel.onchange=()=>{s.type=sel.value;render();};
    card.querySelectorAll(".btn").forEach(b=>{
      b.onclick=()=>{
        const sex=b.dataset.s;
        if(!sexTypes.has(s.type)&&sex==="f")return;
        s[sex]=Math.max(0,s[sex]+Number(b.dataset.d));
        render();
      };
    });
  });
  rebuildOutput();
}
load();
</script>

</body>
</html>
