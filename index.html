<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>æç«œè²©å£²ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</title>
<style>
  :root{
    --bg:#0b0f14;
    --txt:rgba(255,255,255,.92);
    --mut:rgba(255,255,255,.60);
    --stroke:rgba(255,255,255,.10);
    --shadow:0 14px 40px rgba(0,0,0,.30);
    --r:18px;

    /* âœ… æ è‰²ï¼ˆè¦‹ãŸç›®ã¯ã£ãã‚Šï¼‰ */
    --male:#74d7ff;
    --maleBg:rgba(116,215,255,.18);
    --maleStroke:rgba(116,215,255,.40);

    --female:#ff86c8;
    --femaleBg:rgba(255,134,200,.18);
    --femaleStroke:rgba(255,134,200,.40);

    --good:#78ffb3;
  }

  *{box-sizing:border-box}
  body{
    margin:0; color:var(--txt);
    font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
    background:
      radial-gradient(900px 700px at 20% -10%, rgba(116,215,255,.18), transparent 55%),
      radial-gradient(800px 700px at 120% 20%, rgba(255,134,200,.12), transparent 55%),
      var(--bg);
    padding-bottom:110px;
  }

  header{
    position:sticky; top:0; z-index:5;
    padding:14px 14px 10px;
    padding-top:calc(14px + env(safe-area-inset-top));
    backdrop-filter:blur(18px);
    background:linear-gradient(to bottom, rgba(11,15,20,.90), rgba(11,15,20,.35));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  h1{margin:0; font-size:18px}
  .sub{margin-top:6px; color:var(--mut); font-size:12px; line-height:1.35}

  .wrap{padding:12px 14px}

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    border:1px solid var(--stroke);
    border-radius:var(--r);
    padding:12px;
    box-shadow:var(--shadow);
    margin-bottom:10px;
  }
  .toprow{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
  .name{font-weight:900; font-size:15px}

  .rightInfo{display:flex; flex-direction:column; align-items:flex-end; gap:4px}
  .badge{
    font-size:12px;
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    white-space:nowrap;
  }
  .unitPrice{font-size:12px; color:var(--mut)} /* âœ… ã“ã“ã ã‘æ›´æ–°ã™ã‚‹ */

  .controls{margin-top:10px; display:flex; flex-direction:column; gap:10px}
  select{
    width:100%;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:var(--txt);
    border-radius:14px;
    padding:10px 12px;
    font-size:15px;
    outline:none;
  }

  .sexrow{display:flex; gap:10px}
  .sexbox{
    flex:1;
    border-radius:16px;
    padding:10px;
    border:2px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06);
  }
  /* âœ… æ ãƒ»èƒŒæ™¯ã‚’è‰²åˆ†ã‘ */
  .sexbox.male{ background:var(--maleBg); border-color:var(--maleStroke); }
  .sexbox.female{ background:var(--femaleBg); border-color:var(--femaleStroke); }

  .sexhead{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
  .label{font-weight:900; font-size:13px}
  .label.m{color:var(--male)}
  .label.f{color:var(--female)}
  .count{font-variant-numeric:tabular-nums; font-size:20px; font-weight:900}

  .btnrow{display:flex; gap:10px}
  .btn{
    flex:1; height:42px; border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.08);
    color:var(--txt); font-size:22px; font-weight:900;
    touch-action:manipulation;
  }
  .btn.plus.m{ color:var(--male); border-color:rgba(116,215,255,.45); }
  .btn.plus.f{ color:var(--female); border-color:rgba(255,134,200,.45); }

  .disabled{opacity:.35; pointer-events:none}

  .sheet{
    margin-top:12px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    border-radius:18px;
    padding:10px;
  }
  .sheetTop{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px}
  textarea{
    width:100%; height:220px; resize:none;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:var(--txt);
    padding:12px;
    font-size:13px;
    line-height:1.55;
    outline:none;
  }
  .total{font-size:12px; color:var(--mut)}
  .total b{color:var(--good)}

  .bar{
    position:fixed; left:0; right:0; bottom:0; z-index:10;
    padding:10px 12px;
    padding-bottom:calc(10px + env(safe-area-inset-bottom));
    backdrop-filter:blur(18px);
    background:linear-gradient(to top, rgba(11,15,20,.92), rgba(11,15,20,.35));
    border-top:1px solid rgba(255,255,255,.06);
  }
  .barrow{display:flex; gap:10px}
  .action{
    flex:1; height:48px; border-radius:16px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.08);
    color:var(--txt); font-size:16px; font-weight:900;
  }
  .action.primary{
    border-color:rgba(120,255,179,.25);
    background:linear-gradient(180deg, rgba(120,255,179,.22), rgba(255,255,255,.06));
  }
</style>
</head>
<body>

<header>
  <h1>ğŸ¦– æç«œè²©å£²ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</h1>
  <div class="sub">
    ãƒ»dinos.txt ã‹ã‚‰ãƒªã‚¹ãƒˆèª­è¾¼<br>
    ãƒ»å—ç²¾åµ(æŒ‡å®š)/èƒš(æŒ‡å®š)/å¹¼ä½“/æˆä½“ã¯ â™‚â™€è¡¨è¨˜<br>
    ãƒ»ãã‚Œä»¥å¤–ã¯åˆç®—ã§ã€Œå—ç²¾åµÃ—2ã€<br>
    ãƒ»âœ… å—ç²¾åµã¯ â™‚=â™€ ã®ã¨ãã€Œå—ç²¾åµãƒšã‚¢ / å—ç²¾åµãƒšã‚¢Ã—Nã€
  </div>
</header>

<div class="wrap" id="list"></div>

<div class="wrap">
  <div class="sheet">
    <div class="sheetTop">
      <div style="font-size:13px; font-weight:900;">å‡ºåŠ›</div>
      <div class="total">åˆè¨ˆ: <b id="totalView">0å††</b></div>
    </div>
    <textarea id="result" readonly placeholder="ä¸‹ã®ã€Œç”Ÿæˆã€ã§æ–‡ç« ãŒå‡ºã¾ã™"></textarea>
  </div>
</div>

<div class="bar">
  <div class="barrow">
    <button class="action primary" onclick="generate()">ç”Ÿæˆ</button>
    <button class="action" onclick="copyText()">ã‚³ãƒ”ãƒ¼</button>
  </div>
</div>

<script>
  const prices = {"å—ç²¾åµ":30,"å—ç²¾åµ(æŒ‡å®š)":50,"å¹¼ä½“":100,"èƒš":50,"èƒš(æŒ‡å®š)":100,"æˆä½“":500};
  const sexTypes = new Set(["å—ç²¾åµ(æŒ‡å®š)","èƒš(æŒ‡å®š)","å¹¼ä½“","æˆä½“"]);

  let dinos = [];
  const state = new Map();

  const list = document.getElementById("list");
  const totalView = document.getElementById("totalView");

  function yen(n){ return `${Number(n).toLocaleString("ja-JP")}å††`; }

  async function loadDinos(){
    const res = await fetch(`dinos.txt?ts=${Date.now()}`); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿
    const text = await res.text();
    dinos = text.split(/\r?\n/).map(s => s.trim().replace(/^ãƒ»\s*/,"")).filter(Boolean);
    dinos.forEach(d => state.set(d, { type:"å—ç²¾åµ", m:0, f:0 }));
    render();
  }

  function isSexlessType(type){
    // âœ… å—ç²¾åµã ã‘ã¯ãƒšã‚¢åˆ¤å®šã«â™‚â™€ãŒå¿…è¦ãªã®ã§ã€Œæ€§åˆ¥å…¥åŠ›ã‚’æ®‹ã™ã€
    if (type === "å—ç²¾åµ") return false;
    // æŒ‡å®š/å¹¼ä½“/æˆä½“ã¯æ€§åˆ¥è¡¨è¨˜
    if (sexTypes.has(type)) return false;
    // ãã‚Œä»¥å¤–ï¼ˆèƒšãªã©ï¼‰ã¯æ€§åˆ¥ä¸è¦
    return true;
  }

  function render(){
    list.innerHTML = "";
    dinos.forEach(name => {
      const s = state.get(name);

      const card = document.createElement("div");
      card.className = "card";
      card.dataset.name = name;

      card.innerHTML = `
        <div class="toprow">
          <div>
            <div class="name">${name}</div>
            <div class="sub" style="margin-top:4px;">â™‚æ =æ°´è‰² / â™€æ =ãƒ”ãƒ³ã‚¯</div>
          </div>
          <div class="rightInfo">
            <div class="badge">${s.type}</div>
            <div class="unitPrice">å˜ä¾¡ ${yen(prices[s.type] || 0)}</div>
          </div>
        </div>

        <div class="controls">
          <select class="type">
            <option ${s.type==="å—ç²¾åµ"?"selected":""}>å—ç²¾åµ</option>
            <option ${s.type==="å—ç²¾åµ(æŒ‡å®š)"?"selected":""}>å—ç²¾åµ(æŒ‡å®š)</option>
            <option ${s.type==="å¹¼ä½“"?"selected":""}>å¹¼ä½“</option>
            <option ${s.type==="èƒš"?"selected":""}>èƒš</option>
            <option ${s.type==="èƒš(æŒ‡å®š)"?"selected":""}>èƒš(æŒ‡å®š)</option>
            <option ${s.type==="æˆä½“"?"selected":""}>æˆä½“</option>
          </select>

          <div class="sexrow">
            <div class="sexbox male">
              <div class="sexhead">
                <div class="label m">â™‚ ã‚ªã‚¹</div>
                <div class="count mcnt">${s.m}</div>
              </div>
              <div class="btnrow">
                <button class="btn" type="button" data-sex="m" data-d="-1">âˆ’</button>
                <button class="btn plus m" type="button" data-sex="m" data-d="1">ï¼‹</button>
              </div>
            </div>

            <div class="sexbox female">
              <div class="sexhead">
                <div class="label f">â™€ ãƒ¡ã‚¹</div>
                <div class="count fcnt">${s.f}</div>
              </div>
              <div class="btnrow">
                <button class="btn" type="button" data-sex="f" data-d="-1">âˆ’</button>
                <button class="btn plus f" type="button" data-sex="f" data-d="1">ï¼‹</button>
              </div>
            </div>
          </div>

          <div class="sub">åˆè¨ˆã¯ â™‚+â™€ï¼ˆæ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ã¯å‡ºåŠ›ã§åˆç®—è¡¨ç¤ºï¼‰</div>
        </div>
      `;
      list.appendChild(card);

      const sel = card.querySelector(".type");
      const badge = card.querySelector(".badge");
      const unitPriceEl = card.querySelector(".unitPrice");
      const femaleBox = card.querySelector(".female");

      function applyMode(){
        const st = state.get(name);
        badge.textContent = st.type;
        unitPriceEl.textContent = `å˜ä¾¡ ${yen(prices[st.type] || 0)}`; // âœ… æ­£ã—ã„è¦ç´ ã ã‘æ›´æ–°

        if (isSexlessType(st.type)){
          // æ€§åˆ¥ä¸è¦ï¼šå‡ºåŠ›ã¯åˆç®—ã ãŒå…¥åŠ›ã¯æ®‹ã—ã¦OKï¼ˆãŸã ã—æ··ä¹±é˜²æ­¢ã§â™€ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚‚ã„ã„ï¼‰
          // ã“ã“ã¯ã€Œâ™€ç„¡åŠ¹åŒ–ã€ã«ã—ã¦æ“ä½œç°¡ç•¥åŒ–ï¼ˆèƒšãªã©ï¼‰
          st.f = 0;
          card.querySelector(".fcnt").textContent = "0";
          femaleBox.classList.add("disabled");
        } else {
          // å—ç²¾åµ(ãƒšã‚¢åˆ¤å®š)/æ€§åˆ¥è¡¨è¨˜ã‚¿ã‚¤ãƒ—ï¼šâ™€ã‚‚ä½¿ã†
          femaleBox.classList.remove("disabled");
        }
      }

      sel.addEventListener("change", () => {
        const st = state.get(name);
        st.type = sel.value;
        applyMode();
      });

      card.querySelectorAll("button[data-sex]").forEach(b => {
        b.addEventListener("click", () => {
          const st = state.get(name);
          const sex = b.dataset.sex;
          const d = Number(b.dataset.d);

          // æ€§åˆ¥ä¸è¦ã‚¿ã‚¤ãƒ—ã§â™€ã¯ç„¡åŠ¹
          if (isSexlessType(st.type) && sex === "f") return;

          st[sex] = Math.max(0, st[sex] + d);
          card.querySelector(sex==="m" ? ".mcnt" : ".fcnt").textContent = st[sex];
        });
      });

      applyMode();
    });
  }

  function formatLine(type, m, f){
    // æ€§åˆ¥è¡¨è¨˜ã‚¿ã‚¤ãƒ—
    if (sexTypes.has(type)){
      const parts = [];
      if (m>0) parts.push(`â™‚Ã—${m}`);
      if (f>0) parts.push(`â™€Ã—${f}`);
      return `${type} ${parts.join(" ")}`.trim();
    }

    // âœ… å—ç²¾åµï¼šãƒšã‚¢åˆ¤å®š
    if (type === "å—ç²¾åµ"){
      const qty = m + f;
      if (m === f && m > 0){
        return `å—ç²¾åµãƒšã‚¢${m>1 ? "Ã—"+m : ""}`;
      }
      return `å—ç²¾åµÃ—${qty}`;
    }

    // ãã®ä»–ï¼šåˆç®—
    const qty = m + f;
    return `${type}Ã—${qty}`;
  }

  function generate(){
    let lines = [];
    let total = 0;
    let idx = 1;

    dinos.forEach(name => {
      const s = state.get(name);
      if (!s) return;

      const type = s.type;
      const m = s.m;
      const f = isSexlessType(type) ? 0 : s.f; // èƒšãªã©ã¯â™€0å›ºå®š
      const qty = m + f;
      if (qty === 0) return;

      const price = (prices[type] || 0) * qty;
      total += price;

      lines.push(`${idx}. ${name} ${formatLine(type, m, f)} = ${price}å††`);
      idx++;
    });

    totalView.textContent = yen(total);

    document.getElementById("result").value =
`ã“ã®åº¦ã¯ã”æ¤œè¨ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
ã”å¸Œæœ›å†…å®¹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ğŸ‘‡ğŸ»

${lines.join("\n")}
ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
è¨ˆï¼š${total}å††
æœ€çŸ­ç´å“ç›®å®‰ : å³ç´å“å¯èƒ½

ã”å¸Œæœ›å†…å®¹ã€é‡‘é¡ã‚’ã”ç¢ºèªã®ä¸Šè³¼å…¥ã®æ–¹ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ğŸ™ğŸ»

ã¾ãŸã€è¿½åŠ ã‚„å¤‰æ›´ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ğŸ‘ğŸ»`;
  }

  async function copyText(){
    const ta = document.getElementById("result");
    if (!ta.value) return alert("å…ˆã«ã€Œç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
    try{
      await navigator.clipboard.writeText(ta.value);
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }catch(e){
      ta.focus(); ta.select();
      document.execCommand("copy");
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }
  }

  loadDinos();
</script>

</body>
</html>
